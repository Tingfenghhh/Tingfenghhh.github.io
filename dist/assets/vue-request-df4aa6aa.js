import{i as e,f as n,r as t,a4 as a,c as r,h as u,w as o,Y as l}from"./@vue-81915dab.js";const i={},c=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),s=()=>i,v=e=>null!==e&&"object"==typeof e,d=e=>e instanceof Function,f=e=>null==e,m="undefined"==typeof window,h=()=>{var e;return!(!m&&!f(null===(e=window.document)||void 0===e?void 0:e.visibilityState))||"visible"===window.document.visibilityState},p=()=>new Promise((()=>{})),w=e=>l(e)?e.value:e,g=e=>{return v(e)?Object.assign((n=e,Array.isArray(n)?[]:{}),e):e;var n},y=new Map;function E(e,n,t){let a,r,u,o,l,i,c=0,s=!1,d=!1,f=!0;const m=!n&&0!==n&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function h(n){const t=a,u=r;return a=r=void 0,c=n,o=e.apply(u,t),o}function p(e,n){return m?(window.cancelAnimationFrame(l),window.requestAnimationFrame(e)):setTimeout(e,n)}function w(e){const t=e-i;return void 0===i||t>=n||t<0||d&&e-c>=u}function g(){const e=Date.now();if(w(e))return y(e);l=p(g,function(e){const t=e-c,a=n-(e-i);return d?Math.min(a,u-t):a}(e))}function y(e){return l=void 0,f&&a?h(e):(a=r=void 0,o)}function E(...e){const t=Date.now(),u=w(t);if(a=e,r=this,i=t,u){if(void 0===l)return function(e){return c=e,l=p(g,n),s?h(e):o}(i);if(d)return l=p(g,n),h(i)}return void 0===l&&(l=p(g,n)),o}return n=+n||0,v(t)&&(s=!!t.leading,d="maxWait"in t,u=d?Math.max(+t.maxWait||0,n):u,f="trailing"in t?!!t.trailing:f),E.cancel=function(){void 0!==l&&function(e){if(m)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),c=0,a=i=r=l=void 0},E.flush=function(){return void 0===l?o:y(Date.now())},E.pending=function(){return void 0!==l},E}var T=(e,{debounceInterval:n,debounceOptions:a,manual:o})=>{const l=t(!1),i=t(),c=r((()=>a)),s=r((()=>w(n))),v=t(e.context.runAsync);return o||(l.value=!0),u((n=>{f(s.value)||(i.value=E((e=>e()),s.value,c.value),e.context.runAsync=(...e)=>new Promise(((n,t)=>{l.value?(l.value=!1,v.value(...e).then(n).catch(t)):i.value((()=>{v.value(...e).then(n).catch(t)}))})),n((()=>{var n;null===(n=i.value)||void 0===n||n.cancel(),e.context.runAsync=v.value})))})),{onCancel(){var e;null===(e=i.value)||void 0===e||e.cancel()}}},x=(e,{errorRetryCount:n=0,errorRetryInterval:a=0})=>{const u=t(),o=t(0),l=r((()=>w(n))),i=r((()=>w(a)));let c=!1;const s=()=>{o.value=0},v=r((()=>{if(i.value)return i.value;return 1e3*Math.floor(Math.random()*2**Math.min(o.value,9)+1)})),d=()=>{u.value&&u.value()};return{onBefore(){c||s(),c=!1,d()},onSuccess(){s()},onError(){u.value=(()=>{let n;const t=-1===l.value,a=o.value<l.value;return(t||a)&&(t||(o.value+=1),n=setTimeout((()=>{c=!0,e.context.refresh()}),v.value)),()=>n&&clearTimeout(n)})()},onCancel(){s(),d()}}},A=(e,{ready:n=t(!0),manual:a,defaultParams:r=[]})=>(o(n,(n=>{!a&&n&&e.context.run(...r)}),{flush:"sync"}),{onBefore(){if(!n.value)return e.loading.value=!1,{isBreak:!0}}}),S=(e,{refreshDeps:n=[],refreshDepsAction:t,manual:a})=>(null!=n&&n.length&&o(n,(()=>{t?t():!a&&e.context.refresh()})),{}),I=(e,{throttleInterval:n,throttleOptions:a})=>{const o=t(),l=r((()=>w(n))),i=r((()=>a)),c=t(e.context.runAsync);return u((t=>{if(f(n))return{};o.value=function(e,n,t){let a=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return v(t)&&(a="leading"in t?!!t.leading:a,r="trailing"in t?!!t.trailing:r),E(e,n,{leading:a,trailing:r,maxWait:n})}((e=>e()),l.value,i.value),e.context.runAsync=(...e)=>new Promise(((n,t)=>{o.value((()=>{c.value(...e).then(n).catch(t)}))})),t((()=>{var n;null===(n=o.value)||void 0===n||n.cancel(),e.context.runAsync=c.value}))})),{onCancel(){var e;null===(e=o.value)||void 0===e||e.cancel()}}};const O=(e,n,r)=>{var u,o;const{initialData:l,onSuccess:i,onError:c,onBefore:s,onAfter:v}=n,f=t(null!==(u=null==r?void 0:r.loading)&&void 0!==u&&u),m=a(null!==(o=null==r?void 0:r.data)&&void 0!==o?o:l),h=a(null==r?void 0:r.error),w=t(null==r?void 0:r.params),y=t([]),E=a("pending"),T={},x=(A={status:E,loading:f,data:m,error:h,params:w},S=[],e=>{Object.keys(e).forEach((n=>{A[n].value=e[n]})),S.forEach((e=>e(A)))});var A,S;const I=(e,...n)=>{if("onQuery"===e){const e=y.value.map((e=>e.onQuery)).filter(Boolean);return{servicePromise:(t=e,a=n[0],()=>{let e=a;for(let n=t.length;n-- >0;)e=t[n](e);return e()})()}}{const t=y.value.map((t=>{var a;return null===(a=t[e])||void 0===a?void 0:a.call(t,...n)}));return Object.assign({},...t)}var t,a},O=t(0);return T.runAsync=async(...n)=>{x({loading:!0,params:n,status:"pending"}),O.value+=1;const t=O.value,{isBreak:a,breakResult:r=p()}=I("onBefore",n);if(a)return x({status:"settled"}),r;null==s||s(n);try{const a=()=>new Promise((n=>n(e(...w.value))));let{servicePromise:r}=I("onQuery",a);r||(r=a());const u=await r;return t!==O.value?p():(x({data:u,loading:!1,error:void 0,status:"settled"}),I("onSuccess",u,n),null==i||i(u,n),I("onAfter",n,u,void 0),null==v||v(n),u)}catch(u){if(t!==O.value)return p();throw x({loading:!1,error:u,status:"settled"}),I("onError",u,n),null==c||c(u,n),I("onAfter",n,void 0,u),null==v||v(n),u}},T.run=(...e)=>{T.runAsync(...e).catch((e=>{}))},T.cancel=()=>{O.value+=1,x({loading:!1}),I("onCancel")},T.refresh=()=>{T.run(...w.value||[])},T.refreshAsync=()=>T.runAsync(...w.value||[]),T.mutate=e=>{const n=d(e)?e(m.value):e,t=g(n);x({data:t}),I("onMutate",t)},{status:E,loading:f,data:m,error:h,params:w,plugins:y,context:T}};const L=new Map,b=new Map;var C=(e,{cacheKey:a,cacheTime:r=6e5,staleTime:u=0,getCache:o,setCache:l})=>{if(!a)return{};const i=d(a)?a:()=>a,c=t((()=>{}));let s;const v=e=>o?o(e):(e=>{if(f(e))return;return y.get(e)})(e),m=(e,n,t)=>{l?l(e,t):((e,n,t)=>{const a=y.get(e);null!=a&&a.timer&&clearTimeout(a.timer);const r=setTimeout((()=>y.delete(e)),n);y.set(e,{...t,timer:r})})(e,n,t),((e,n)=>{b.has(e)&&b.get(e).forEach((e=>e(n)))})(e,t.data)},h=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),p=n=>{const t=i(n);return a=t,r=n=>{e.data.value=n},b.has(a)?b.get(a).push(r):b.set(a,[r]),()=>{const e=b.get(a).indexOf(r);b.get(a).splice(e,1)};var a,r},w=i(),g=v(w);return g&&h(g,"data")&&(e.data.value=g.data,e.params.value=g.params),w&&(c.value=p()),n((()=>{c.value()})),{onBefore(n){const t=i(n),a=v(t);return a&&h(a,"data")?(r=a.time,-1===u||r+u>(new Date).getTime()?(e.data.value=a.data,e.loading.value=!1,{isBreak:!0,breakResult:a.data}):void(e.data.value=a.data)):{};var r},onQuery(n){const t=e.params.value,a=i(t);let r=(e=>L.get(e))(a);return r&&r!==s||(r=n(),s=r,((e,n)=>{L.set(e,n),n.then((n=>(L.delete(e),n))).catch((()=>{L.delete(e)}))})(a,r)),()=>r},onSuccess(e,n){const t=i(n);t&&(c.value(),m(t,r,{data:e,params:n,time:(new Date).getTime()}),c.value=p(n))},onMutate(n){const t=i(e.params.value);t&&(c.value(),m(t,r,{data:n,params:e.params.value,time:(new Date).getTime()}),c.value=p(e.params.value))}}};function P(){return(new Date).getTime()}var B,R=(e,{loadingDelay:n=0,loadingKeep:a=0})=>{const u=t((()=>{})),o=r((()=>w(n))),l=r((()=>w(a)));let i=0,c={};return{onBefore(){e.loading.value=!o.value,u.value(),u.value=(()=>{let n;return o.value&&(n=setTimeout((()=>{"pending"===e.status.value&&(e.loading.value=!0)}),o.value)),()=>n&&clearTimeout(n)})(),i=P()},onQuery(e){if(!l.value)return()=>e();c=function(e){let n,t;return new class extends Promise{constructor(e){super(e),this.cancel=()=>{t(),clearTimeout(n)}}}((a=>{t=a,n=setTimeout(t,e)}))}(l.value+o.value);const n=Promise.allSettled([(async()=>{try{const n=await e();return P()-i<=o.value&&c.cancel(),Promise.resolve(n)}catch(n){return P()-i<=o.value&&c.cancel(),Promise.reject(n)}})(),c]).then((e=>{const n=e[0];return"fulfilled"===n.status?n.value:Promise.reject(n.reason)}));return()=>n},onCancel(){u.value()},onAfter(){u.value()}}};const D=new Set,N=new Set,M=new Set,_=(e,n)=>{let t;switch(e){case"FOCUS_LISTENER":t=D;break;case"RECONNECT_LISTENER":t=M;break;case"VISIBLE_LISTENER":t=N}if(!t.has(n))return t.add(n),()=>{t.delete(n)}},j=e=>{e.forEach((e=>{e()}))};!m&&null!==(B=window)&&void 0!==B&&B.addEventListener&&(window.addEventListener("visibilitychange",(()=>{h()&&j(N)}),!1),window.addEventListener("focus",(()=>j(D)),!1),window.addEventListener("online",(()=>j(M)),!1));var k=(e,{pollingInterval:a,pollingWhenHidden:u=!1,pollingWhenOffline:l=!1,errorRetryCount:i=0})=>{const c=t(),s=t(!1),v=r((()=>w(a))),d=r((()=>w(i))),p=[],g=e=>{e&&p.push(e)},y=()=>{return(u||h())&&(l||null===(e=!m&&(null===(n=window.navigator)||void 0===n?void 0:n.onLine))||void 0===e||e);var e,n},E=n=>{if(e.error.value&&0!==d.value)return;let t;if(!f(v.value)&&v.value>=0){if(!y())return void(s.value=!0);t=setTimeout(n,v.value)}return()=>t&&clearTimeout(t)},T=()=>{s.value&&y()&&(e.context.refresh(),s.value=!1)};return o(v,(()=>{c.value&&(c.value(),c.value=E((()=>e.context.refresh())))})),u||g(_("VISIBLE_LISTENER",T)),l||g(_("RECONNECT_LISTENER",T)),n((()=>{p.forEach((e=>e()))})),{onBefore(){var e;null===(e=c.value)||void 0===e||e.call(c)},onCancel(){var e;null===(e=c.value)||void 0===e||e.call(c)},onAfter(){c.value=E((()=>e.context.refresh()))}}};var F=(e,{refreshOnWindowFocus:t=!1,refocusTimespan:a=5e3})=>{const o=r((()=>w(t))),l=r((()=>w(a))),i=[],c=e=>{e&&i.push(e)},s=()=>{i.forEach((e=>e()))};return u((()=>{if(s(),o.value){const n=((e,n)=>{let t=!1;return(...a)=>{t||(t=!0,e(...a),setTimeout((()=>{t=!1}),n))}})(e.context.refresh,l.value);c(_("VISIBLE_LISTENER",n)),c(_("FOCUS_LISTENER",n))}})),n((()=>{s()})),{}};function W(t,a){return function(t,a={},r){const u=e(c,{}),o={...s(),...u,...a},{manual:l=!1,defaultParams:i=[]}=o,v=O(t,o);if(v.plugins.value=r.map((e=>e(v,o))),!l){const e=v.params.value||i;v.context.run(...e)}return n((()=>{v.context.cancel()})),{loading:v.loading,data:v.data,error:v.error,params:v.params,cancel:v.context.cancel,refresh:v.context.refresh,refreshAsync:v.context.refreshAsync,mutate:v.context.mutate,run:v.context.run,runAsync:v.context.runAsync}}(t,a,[R,x,T,k,I,F,S,A,C])}export{W as u};
